{"ast":null,"code":"var _jsxFileName = \"/Users/minh/Desktop/TestSite/wc-prototype/src/pages/components/MarketGrid.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport * as sdk from \"@onflow/sdk\";\nimport Modal from 'react-modal';\nimport TokenDataMarketTest from \"./TokenDataMarketTest\"; // Mainnet Access Node\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst node = \"http://localhost:8080\";\nconst EVENT_MOMENT_LISTED = \"A.f8d6e0586b0a20c7.Marketplace.ForSale\"; // since last block returned is not sealed\n// we will go back a bit back in time\n\nvar SHIFT = 1;\nlet isSealed = false;\n\nfunction union(setA, setB) {\n  var _union = new Set(setA);\n\n  for (var elem of setB) {\n    _union.add(elem);\n  }\n\n  return _union;\n}\n\nexport default function MarketGrid() {\n  _s();\n\n  const [lastBlock, setLastBlock] = useState(0);\n  const [eventIDs, setEventIdS] = useState(new Set());\n  const [eventsDictionary, setEventsDictionary] = useState({});\n  const [modalIsOpen, setIsOpen] = useState(false);\n  Modal.setAppElement(document.getElementById('/Marketplace'));\n\n  function openModal(eventId) {\n    console.log(eventId);\n    setIsOpen(true);\n  }\n\n  function afterOpenModal() {// references are now sync'd and can be accessed.\n  }\n\n  function closeModal() {\n    setIsOpen(false);\n  }\n\n  const fetchEvents = async () => {\n    const latestBlock = await sdk.send(await sdk.build([sdk.getBlock(isSealed)]), {\n      node\n    });\n    const height = latestBlock.block.height;\n    let end = height;\n    let start = SHIFT; // fetch events\n\n    const response = await sdk.send(await sdk.build([sdk.getEventsAtBlockHeightRange(EVENT_MOMENT_LISTED, start, end)]), {\n      node\n    });\n    const {\n      events\n    } = response;\n\n    if (events.length > 0) {\n      const newSet = new Set(events.map(event => {\n        const id = event.payload.value.fields[0].value.value;\n        eventsDictionary[id] = event;\n        return id;\n      }));\n      const newEvents = union(eventIDs, newSet);\n      setEventsDictionary(eventsDictionary);\n      setEventIdS(newEvents);\n    } // update last processed block\n\n\n    setLastBlock(height);\n  };\n\n  useEffect(() => {\n    fetchEvents();\n  }, []);\n  const events = Array.from(eventIDs);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Marketplace\",\n    children: [console.log(\"Memory Test\"), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"center\",\n      children: events.map(eventId => {\n        const event = eventsDictionary[eventId];\n        const payload = event.payload.value.fields;\n        const [id, price, seller] = payload;\n        const nftId = id.value.value;\n        const nftPrice = price.value.value;\n        console.log(nftPrice);\n        const nftSeller = seller.value.value.value;\n\n        const nftMetadata = /*#__PURE__*/_jsxDEV(TokenDataMarketTest, {\n          account: nftSeller,\n          nftID: nftId\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 33\n        }, this);\n\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"column\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => openModal(eventId),\n            children: nftMetadata\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 39\n          }, this), /*#__PURE__*/_jsxDEV(Modal, {\n            isOpen: modalIsOpen,\n            onAfterOpen: afterOpenModal,\n            onRequestClose: closeModal,\n            contentLabel: \"Example Modal\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"NFT\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: closeModal,\n              children: \"close\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [nftMetadata, /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"column\",\n                children: [\"Seller: \", nftSeller, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 115,\n                  columnNumber: 21\n                }, this), \"Price: \", nftPrice]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 113,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 15\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n}\n\n_s(MarketGrid, \"gSNd8arp6+XVFPJn6ghfrXwkR4c=\");\n\n_c = MarketGrid;\n\nvar _c;\n\n$RefreshReg$(_c, \"MarketGrid\");","map":{"version":3,"sources":["/Users/minh/Desktop/TestSite/wc-prototype/src/pages/components/MarketGrid.js"],"names":["React","useEffect","useState","sdk","Modal","TokenDataMarketTest","node","EVENT_MOMENT_LISTED","SHIFT","isSealed","union","setA","setB","_union","Set","elem","add","MarketGrid","lastBlock","setLastBlock","eventIDs","setEventIdS","eventsDictionary","setEventsDictionary","modalIsOpen","setIsOpen","setAppElement","document","getElementById","openModal","eventId","console","log","afterOpenModal","closeModal","fetchEvents","latestBlock","send","build","getBlock","height","block","end","start","response","getEventsAtBlockHeightRange","events","length","newSet","map","event","id","payload","value","fields","newEvents","Array","from","price","seller","nftId","nftPrice","nftSeller","nftMetadata"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport * as sdk from \"@onflow/sdk\";\nimport Modal from 'react-modal';\nimport TokenDataMarketTest from \"./TokenDataMarketTest\";\n\n// Mainnet Access Node\nconst node = \"http://localhost:8080\";\nconst EVENT_MOMENT_LISTED = \"A.f8d6e0586b0a20c7.Marketplace.ForSale\";\n\n// since last block returned is not sealed\n// we will go back a bit back in time\nvar SHIFT = 1;\nlet isSealed = false\n\nfunction union(setA, setB) {\n  var _union = new Set(setA);\n  for (var elem of setB) {\n    _union.add(elem);\n  }\n  return _union;\n}\n\nexport default function MarketGrid() {\n  const [lastBlock, setLastBlock] = useState(0);\n  const [eventIDs, setEventIdS] = useState(new Set());\n  const [eventsDictionary, setEventsDictionary] = useState({});\n  const [modalIsOpen, setIsOpen] = useState(false);\n\n  Modal.setAppElement(document.getElementById('/Marketplace'));\n\n  function openModal(eventId) {\n    console.log(eventId);\n    setIsOpen(true);\n  }\n\n  function afterOpenModal() {\n    // references are now sync'd and can be accessed.\n  }\n\n  function closeModal() {\n    setIsOpen(false);\n  }\n\n  const fetchEvents = async () => {\n    const latestBlock = await sdk.send(\n      await sdk.build([sdk.getBlock(isSealed)]),\n      {\n        node\n      }\n    );\n\n    const height = latestBlock.block.height;\n    let end = height;\n    let start = SHIFT;\n\n    // fetch events\n    const response = await sdk.send(\n      await sdk.build([sdk.getEventsAtBlockHeightRange(EVENT_MOMENT_LISTED, start, end)]),\n      { node }\n    );\n\n    const { events } = response;\n\n    if (events.length > 0) {\n      const newSet = new Set(\n        events.map((event) => {\n          const id = event.payload.value.fields[0].value.value;\n          eventsDictionary[id] = event;\n          return id;\n        })\n      );\n      const newEvents = union(eventIDs, newSet);\n      setEventsDictionary(eventsDictionary);\n      setEventIdS(newEvents);\n    }\n\n    // update last processed block\n    setLastBlock(height);\n  };\n\n  useEffect(() => {\n    fetchEvents();\n  },[]);\n\n  const events = Array.from(eventIDs);\n\n  return (\n    \n    <div className=\"Marketplace\">\n      {console.log(\"Memory Test\")}\n      <div className=\"center\">\n      {events.map((eventId) => {\n            const event = eventsDictionary[eventId];\n            const payload = event.payload.value.fields;\n            const [id, price, seller] = payload;\n            const nftId = id.value.value;\n            const nftPrice = price.value.value;\n            console.log(nftPrice);\n            const nftSeller = seller.value.value.value;\n            const nftMetadata = <TokenDataMarketTest account={nftSeller} nftID={nftId}></TokenDataMarketTest>\n            return (\n              <div className=\"column\"><button onClick={() => openModal(eventId)}>{nftMetadata}</button>\n              <Modal\n                isOpen={modalIsOpen}\n                onAfterOpen={afterOpenModal}\n                onRequestClose={closeModal}\n                contentLabel=\"Example Modal\"\n              >\n                <h2>NFT</h2>\n                <button onClick={closeModal}>close</button>\n                <div>\n                  {nftMetadata}\n                  <div className=\"column\">\n                    Seller: {nftSeller}\n                    <br/>\n                    Price: {nftPrice}\n                  </div>\n                </div>\n              </Modal></div>\n            );\n          })}\n      </div>     \n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}